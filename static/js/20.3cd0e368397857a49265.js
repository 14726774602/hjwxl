webpackJsonp([20],{"2Ok7":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var o=e("MDz/"),a={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"page-container"},[t.hideLoading?e("m_loading"):t._e(),t._v(" "),e("div",{staticClass:"page-header animated fadeInDown"},[e("p",{staticClass:"page-title"},[t._v("💕"+t._s(t.photoItem.title)+"💕")]),t._v(" "),e("p",{staticClass:"page-time"},[t._v(t._s(t._f("dateFormat")(t.photoItem.issueTime)))]),t._v(" "),e("p",{staticClass:"page-intro"},[t._v(t._s(t.photoItem.intro))])]),t._v(" "),e("div",{staticClass:"life-content",style:{minHeight:t.max_height+"px"}},t._l(t.imgArr,function(i,o){return e("div",{key:o,staticClass:"life-item",style:{left:t.item_coor[o].left+"px",top:t.item_coor[o].top+"px"}},[e("div",[e("a",{attrs:{href:"javascript:;"}},[e("p",{staticClass:"item-img"},[e("img",{attrs:{src:i,alt:""}})])])])])}),0),t._v(" "),e("div",{staticClass:"page-like"},[e("span",{on:{click:function(i){return t.getLike()}}},[t._v("❤（"+t._s(t.photoItem.alike)+"）")])])],1),t._v(" "),e("div",{staticClass:"page-comment"},[t.isRouterAlive?e("comment"):t._e()],1)])},staticRenderFns:[]};var n=function(t){e("VD2M")},h=e("VU/8")(o.a,a,!1,n,"data-v-4744e672",null);i.default=h.exports},"MDz/":function(t,i,e){"use strict";(function(t){var o=e("BO1k"),a=e.n(o),n=e("59g0"),h=e("kkGL");i.a={components:{m_loading:n.a,comment:h.a},data:function(){return{isRouterAlive:!0,name:"相册页面",hideLoading:!0,photoItem:"",imgArr:[],col:2,col_height:[],col_width:"",item_height:[],item_coor:[],item_btm:10,max_height:"",screenWidth:document.body.clientWidth,count:0}},props:{deta:{default:function(){return""}}},beforeCreate:function(){},created:function(){},mounted:function(){var t=this;this.getPhotoItem();var i=this;window.onresize=function(){return window.screenWidth=document.body.clientWidth,i.screenWidth=window.screenWidth,void t.quireCoord()}},methods:{setCookie:function(t,i,e){var o=new Date;o.setTime(o.getTime()+24*e*60*60*1e3);var a="expires="+o.toUTCString();document.cookie=t+"="+i+"; "+a},getLike:function(){var t="photo_page"+this.$route.query.id,i=this.$cookie.get(t),e=this.$route.query.id,o=this;this.axios.get("http://localhost:3306/photo/getLike",{params:{id:e}}).then(function(e){e.data.length>0?(0==i|!i?(e.data[0].alike+=1,o.setCookie(t,1,.5)):(e.data[0].alike-=1,o.setCookie(t,0,.5)),o.photoItem.alike=e.data[0].alike,o.addLike()):alert("获取数据失败")}).catch(function(t){console.log(t)})},addLike:function(){var t=this.$route.query.id,i=this.photoItem.alike,e=this.qs.stringify({id:t,alike:i});this.axios({method:"post",url:"http://localhost:3306/photo/addLike",data:e}).then(function(t){200==t.data.code&&console.log(t.data.msg)})},getPhotoItem:function(){var t=this.$route.query.id,i=this;this.axios.get("http://localhost:3306/photo/item",{params:{id:t}}).then(function(t){if(t.data.length>0){i.photoItem=t.data[0],i.imgArr=i.photoItem.photo.split(","),i.item_coor=[];for(var e=0;e<i.imgArr.length;e++)i.item_coor.push({left:"0",top:"0"});i.preload()}else alert("获取数据失败")}).catch(function(t){console.log(t)})},preload:function(){var t=this,i=!0,e=!1,o=void 0;try{for(var n,h=a()(this.imgArr);!(i=(n=h.next()).done);i=!0){var s=n.value,r=new Image;r.src=s,r.onload=function(){t.count++}}}catch(t){e=!0,o=t}finally{try{!i&&h.return&&h.return()}finally{if(e)throw o}}},quireCoord:function(){this.addWindow(),this.col_width=t(".life-item").width();var i=[],e=[];t(".life-item").each(function(){i.push(Math.ceil(t(this).height())),e.push({left:"0",top:"0"})}),this.item_height=[].concat(i);for(var o=0;o<this.col;o++)this.col_height[o]=0;this.addCoord()},addCoord:function(){for(var t=0;t<this.imgArr.length;t++){var i=Math.min.apply(Math,this.col_height),e=this.col_height.indexOf(i);this.item_coor[t].left=this.col_width*e,this.item_coor[t].top=this.col_height[e],this.col_height[e]+=this.item_height[t],this.col_height[e]+=this.item_btm;var o=Math.max.apply(Math,this.col_height);this.max_height=o}},addWindow:function(){this.screenWidth>1e3?this.col=3:this.screenWidth>750?this.col=2:this.col=1},reload:function(){var t=this;this.isRouterAlive=!1,this.$nextTick(function(){return t.isRouterAlive=!0})}},watch:{count:function(t){if(""!=this.imgArr&&t==this.imgArr.length&&0!=t){var i=this;setTimeout(function(){i.hideLoading=!1},300);i.quireCoord()}}}}}).call(i,e("7t+N"))},VD2M:function(t,i){}});
//# sourceMappingURL=20.3cd0e368397857a49265.js.map